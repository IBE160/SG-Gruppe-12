// prisma/schema.prisma

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                     String   @id @default(uuid())
  email                  String   @unique
  password_hash          String
  name                   String?
  consent_essential      Boolean  @default(true)
  consent_ai_training    Boolean  @default(false)
  consent_marketing      Boolean  @default(false)
  createdAt              DateTime @default(now()) @map("created_at")
  updatedAt              DateTime @updatedAt @map("updated_at")
  lastLoginAt            DateTime? @map("last_login_at")
  emailVerified          Boolean  @default(false)
  emailVerificationToken String?
  passwordResetToken     String?

  // Relations
  cvs                    CV[]

  @@map("User")
}

model CV {
  id            String   @id @default(uuid())
  userId        String
  personal_info Json
  education     Json[]
  experience    Json[]
  skills        Json[]
  languages     Json[]
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  // Relations
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  versions      CVVersion[]

  @@map("CV")
}

model CVVersion {
  id             String   @id @default(uuid())
  cvId           String
  version_number Int
  snapshot       Json
  createdAt      DateTime @default(now()) @map("created_at")

  // Relations
  cv             CV       @relation(fields: [cvId], references: [id], onDelete: Cascade)

  @@unique([cvId, version_number])
  @@map("CVVersion")
}
